<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å‘˜å·¥å·¥æ—¶ç®¡ç†</title>
    <style>
        /* ä¿æŒåŸæœ‰æ ·å¼ */
        .filters {
            background: white;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .filter-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 120px;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .pagination button:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }
        .pagination button.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .pagination select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 10px;
        }
        /* æ–°å¢åˆ†é¡µä¿¡æ¯æ ·å¼ */
        .page-info {
            background: #fff;
            padding: 8px 16px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin: 0 15px;
            min-width: 200px;
            text-align: center;
            color: #666;
        }
        .page-info span {
            color: #2196F3;
            font-weight: bold;
            margin: 0 4px;
        }
        /* ä¿æŒå…¶ä»–åŸæœ‰æ ·å¼ */
        .add-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .add-button:hover {
            background-color: #45a049;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 4px;
        }
        .modal-content h2 {
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-buttons {
            text-align: right;
            margin-top: 20px;
        }
        .form-buttons button {
            margin-left: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-buttons button.cancel {
            background-color: #f44336;
            color: white;
        }
        .form-buttons button.submit {
            background-color: #4CAF50;
            color: white;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        thead tr {
            background-color: #2196F3;
            color: white;
            border-bottom: 1px solid #eee;
        }
        th {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-weight: normal;
            white-space: nowrap;
        }
        th:first-child {
            width: 40px;
        }
        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .status-pending {
            background-color: #2196F3;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
            width: 80px;
        }
        .status-processing {
            background-color: #4CAF50;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
            width: 80px;
        }
        .status-completed {
            background-color: #9E9E9E;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
            width: 80px;
        }
        .task-icon {
            color: #5677fc;
            margin-right: 5px;
        }
        .deadline-tag {
            color: #ff9800;
            font-size: 12px;
            margin-left: 5px;
        }
        .avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #ccc;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        .avatar-blue {
            background-color: #2196F3;
        }
        .avatar-orange {
            background-color: #FF9800;
        }
        .avatar-pink {
            background-color: #E91E63;
        }
        .nav-bar {
            background-color: #2196F3;
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .navigation a {
            margin: 0 10px;
            text-decoration: none;
            color: #2196F3;
            font-weight: bold;
        }
        .navigation a:hover {
            text-decoration: underline;
        }
        .status-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: none;
            border-radius: 4px;
            padding: 6px 24px 6px 12px;
            font-size: 14px;
            width: 100px;
            cursor: pointer;
            text-align: center;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 6px center;
            background-size: 16px;
            transition: all 0.3s ease;
            color: white;
        }
        .status-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }
        .status-select option {
            background-color: white;
            color: #333;
            padding: 8px;
        }
        .status-select.status-pending,
        .status-select.status-processing,
        .status-select.status-completed {
            color: white !important;
        }
        .edit-button {
            padding: 6px 12px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .edit-button:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
    <h1>å‘˜å·¥å·¥æ—¶ç®¡ç†ç³»ç»Ÿ</h1>
    
    <div class="navigation">
        <a href="/">åˆ—è¡¨è§†å›¾</a>
        <a href="/calendar">æ—¥å†è§†å›¾</a>
        <a href="/gantt">ç”˜ç‰¹å›¾è§†å›¾</a>
        <a href="/today">ä»Šæ—¥ä»»åŠ¡</a>
    </div>
    
    <!-- ç¼–è¾‘ä»»åŠ¡çš„æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>ç¼–è¾‘ä»»åŠ¡</h2>
            <input type="hidden" id="editIndex">
            <div class="form-group">
                <label for="editName">è´Ÿè´£äºº:</label>
                <input type="text" id="editName" required>
            </div>
            <div class="form-group">
                <label for="editTask">ä»»åŠ¡æ ‡é¢˜:</label>
                <input type="text" id="editTask" required>
            </div>
            <div class="form-group">
                <label for="editStatus">çŠ¶æ€:</label>
                <select id="editStatus">
                    <option value="å¾…å¤„ç†">å¾…å¤„ç†</option>
                    <option value="å¤„ç†ä¸­">å¤„ç†ä¸­</option>
                    <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editStartTime">è®¡åˆ’å¼€å§‹æ—¶é—´:</label>
                <input type="date" id="editStartTime" required>
            </div>
            <div class="form-group">
                <label for="editEndTime">è®¡åˆ’å®Œæˆæ—¶é—´:</label>
                <input type="date" id="editEndTime" required>
            </div>
            <div class="form-buttons">
                <button class="cancel" onclick="closeModal('editModal')">å–æ¶ˆ</button>
                <button class="submit" onclick="submitEditForm()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ä»»åŠ¡çš„æ¨¡æ€æ¡† -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h2>æ–°å¢ä»»åŠ¡</h2>
            <div class="form-group">
                <label for="name">è´Ÿè´£äºº:</label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <label for="task">ä»»åŠ¡æ ‡é¢˜:</label>
                <input type="text" id="task" required>
            </div>
            <div class="form-group">
                <label for="status">çŠ¶æ€:</label>
                <select id="status">
                    <option value="å¾…å¤„ç†">å¾…å¤„ç†</option>
                    <option value="å¤„ç†ä¸­">å¤„ç†ä¸­</option>
                    <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="startTime">è®¡åˆ’å¼€å§‹æ—¶é—´:</label>
                <input type="date" id="startTime" required>
            </div>
            <div class="form-group">
                <label for="endTime">è®¡åˆ’å®Œæˆæ—¶é—´:</label>
                <input type="date" id="endTime" required>
            </div>
            <div class="form-buttons">
                <button class="cancel" onclick="closeModal('addModal')">å–æ¶ˆ</button>
                <button class="submit" onclick="submitForm()">æäº¤</button>
            </div>
        </div>
    </div>

    <!-- ç­›é€‰å™¨ -->
    <div class="filters">
        <div class="filter-group">
            <label for="filterName">è´Ÿè´£äºº:</label>
            <select id="filterName" onchange="applyFilters()">
                <option value="">å…¨éƒ¨</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="filterStatus">çŠ¶æ€:</label>
            <select id="filterStatus" onchange="applyFilters()">
                <option value="">å…¨éƒ¨</option>
                <option value="å¾…å¤„ç†">å¾…å¤„ç†</option>
                <option value="å¤„ç†ä¸­">å¤„ç†ä¸­</option>
                <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
            </select>
        </div>
    </div>

    <button class="add-button" onclick="openModal('addModal')">æ–°å¢ä»»åŠ¡</button>

    <table id="employeeTable">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>è´Ÿè´£äºº</th>
                <th>æ ‡é¢˜</th>
                <th>çŠ¶æ€</th>
                <th>è®¡åˆ’å¼€å§‹æ—¶é—´</th>
                <th>è®¡åˆ’å®Œæˆæ—¶é—´</th>
                <th>å®é™…å®Œæˆæ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <!-- åˆ†é¡µæ§ä»¶ -->
    <div class="pagination">
        <button onclick="changePage(currentPage - 1)" id="prevPage">ä¸Šä¸€é¡µ</button>
        <div class="page-info" id="pageInfo"></div>
        <button onclick="changePage(currentPage + 1)" id="nextPage">ä¸‹ä¸€é¡µ</button>
        <select id="pageSize" onchange="changePageSize()">
            <option value="5">5æ¡/é¡µ</option>
            <option value="10" selected>10æ¡/é¡µ</option>
            <option value="20">20æ¡/é¡µ</option>
            <option value="50">50æ¡/é¡µ</option>
        </select>
    </div>

    <script>
        let currentPage = 1;
        let pageSize = 10;
        let filteredData = [];
        let employeeData = { employees: [] };
        let lastDataHash = '';

        // æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°
        const formatDateForInput = (dateStr) => {
            if (!dateStr || dateStr === '--') return '';
            const [year, month, day] = dateStr.split('-').map(s => s.padStart(2, '0'));
            const fullYear = year.length === 4 ? year : `20${year}`;
            return `${fullYear}-${month}-${day}`;
        };

        const formatDateForDisplay = (dateStr) => {
            if (!dateStr || dateStr === '--') return '--';
            const date = new Date(dateStr);
            const year = date.getFullYear().toString().padStart(4, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            const startIndex = (currentPage - 1) * pageSize + 1;
            const endIndex = Math.min(currentPage * pageSize, filteredData.length);
            const pageInfo = document.getElementById('pageInfo');
            
            if (filteredData.length === 0) {
                pageInfo.innerHTML = 'æš‚æ— æ•°æ®';
            } else {
                pageInfo.innerHTML = `
                    å…±<span>${totalPages}</span>é¡µ 
                    ç¬¬<span>${currentPage}</span>é¡µ 
                    ï¼ˆ<span>${startIndex}-${endIndex}</span>/<span>${filteredData.length}</span>æ¡ï¼‰
                `;
            }
            
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage >= totalPages;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderCalendar();
            }
        }

        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            renderCalendar();
        }

        function applyFilters() {
            const nameFilter = document.getElementById('filterName').value;
            const statusFilter = document.getElementById('filterStatus').value;
            
            filteredData = employeeData.employees.filter(employee => {
                const nameMatch = !nameFilter || employee.name === nameFilter;
                const statusMatch = !statusFilter || employee.status === statusFilter;
                return nameMatch && statusMatch;
            });

            currentPage = 1;
            renderCalendar();
        }

        function updateNameFilter() {
            const nameFilter = document.getElementById('filterName');
            const names = [...new Set(employeeData.employees.map(e => e.name))];
            
            const currentValue = nameFilter.value;
            nameFilter.innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            names.sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                nameFilter.appendChild(option);
            });
            
            if (names.includes(currentValue)) {
                nameFilter.value = currentValue;
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function editTask(index) {
            const task = employeeData.employees[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('editName').value = task.name;
            document.getElementById('editTask').value = task.task;
            document.getElementById('editStatus').value = task.status;
            document.getElementById('editStartTime').value = formatDateForInput(task.startTime);
            document.getElementById('editEndTime').value = formatDateForInput(task.endTime);
            openModal('editModal');
        }

        function submitEditForm() {
            const index = parseInt(document.getElementById('editIndex').value);
            const name = document.getElementById('editName').value;
            const task = document.getElementById('editTask').value;
            const status = document.getElementById('editStatus').value;
            const startTime = document.getElementById('editStartTime').value;
            const endTime = document.getElementById('editEndTime').value;

            if (!name || !task || !startTime || !endTime) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                return;
            }

            if (new Date(startTime) > new Date(endTime)) {
                alert('å¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´ï¼');
                return;
            }

            // ä¿ç•™åŸæœ‰çš„å±æ€§ï¼Œåªæ›´æ–°ä¿®æ”¹çš„å­—æ®µ
            const updatedTask = {
                ...employeeData.employees[index], // ä¿ç•™åŸæœ‰å±æ€§
                name,
                task,
                status,
                startTime: formatDateForDisplay(startTime),
                endTime: formatDateForDisplay(endTime)
            };

            if (status === 'å·²å®Œæˆ') {
                updatedTask.completedTime = formatDateForDisplay(new Date());
            } else {
                updatedTask.completedTime = '--';
            }

            // æ›´æ–°æ•°æ®
            employeeData.employees[index] = updatedTask;

            fetch('http://localhost:8000/updateData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(employeeData, null, 4)
            }).then(response => {
                if (!response.ok) {
                    throw new Error('ä¿å­˜å¤±è´¥');
                }
                closeModal('editModal');
                alert('ä¿®æ”¹ä»»åŠ¡æˆåŠŸï¼');
                window.location.reload(); // å¼ºåˆ¶åˆ·æ–°é¡µé¢
            }).catch(error => {
                console.error('ä¿®æ”¹å¤±è´¥:', error);
                alert('ä¿®æ”¹ä»»åŠ¡å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            });
        }

        function submitForm() {
            const name = document.getElementById('name').value;
            const task = document.getElementById('task').value;
            const status = document.getElementById('status').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;

            if (!name || !task || !startTime || !endTime) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                return;
            }

            if (new Date(startTime) > new Date(endTime)) {
                alert('å¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´ï¼');
                return;
            }

            const newEmployee = {
                name,
                task,
                status,
                startTime: formatDateForDisplay(startTime),
                endTime: formatDateForDisplay(endTime)
            };

            if (status === 'å·²å®Œæˆ') {
                newEmployee.completedTime = formatDateForDisplay(new Date());
            } else {
                newEmployee.completedTime = '--';
            }

            employeeData.employees.push(newEmployee);
            updateData('addModal');
        }

        function updateData(modalId) {
            fetch('http://localhost:8000/updateData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(employeeData, null, 4)
            }).then(response => {
                if (!response.ok) {
                    throw new Error('ä¿å­˜å¤±è´¥');
                }
                closeModal(modalId);
                if (modalId === 'addModal') {
                    alert('æ–°å¢ä»»åŠ¡æˆåŠŸï¼');
                } else {
                    alert('ä¿®æ”¹ä»»åŠ¡æˆåŠŸï¼');
                }
                window.location.reload(); // å¼ºåˆ¶åˆ·æ–°æ•´ä¸ªé¡µé¢
            }).catch(error => {
                console.error('æ“ä½œå¤±è´¥:', error);
                alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            });
        }

        function loadData() {
            fetch(`data.json?t=${Date.now()}`)
                .then(response => response.json())
                .then(data => {
                    const newDataHash = JSON.stringify(data);
                    if (newDataHash !== lastDataHash) {
                        employeeData = data;
                        lastDataHash = newDataHash;
                        renderCalendar();
                    }
                })
                .catch(error => console.error('åŠ è½½æ•°æ®å¤±è´¥:', error));
        }

        window.onload = () => {
            loadData();
            setInterval(loadData, 30000);
        };

        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#tableBody input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        function renderCalendar() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            updateNameFilter();
            
            if (!filteredData.length && employeeData.employees.length) {
                filteredData = [...employeeData.employees];
            }

            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filteredData.slice(start, end);

            updatePagination();

            pageData.forEach((employee, index) => {
                const row = document.createElement('tr');
                
                const checkboxCell = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.dataset.index = index;
                checkboxCell.appendChild(checkbox);
                
                const nameCell = document.createElement('td');
                const avatar = document.createElement('div');
                avatar.className = `avatar avatar-${getAvatarColor(employee.name)}`;
                avatar.textContent = employee.name.charAt(0);
                nameCell.appendChild(avatar);
                nameCell.appendChild(document.createTextNode(' ' + employee.name));
                
                const taskCell = document.createElement('td');
                taskCell.style.textAlign = 'left';
                taskCell.innerHTML = `<span class="task-icon">ğŸ“‹</span>${employee.task}`;
                
                const statusCell = document.createElement('td');
                const statusSelect = document.createElement('select');
                statusSelect.className = 'status-select';
                
                const statuses = ['å¾…å¤„ç†', 'å¤„ç†ä¸­', 'å·²å®Œæˆ'];
                statuses.forEach(status => {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status;
                    option.selected = status === employee.status;
                    statusSelect.appendChild(option);
                });

                statusSelect.className = `status-select ${getStatusClass(employee.status)}`;
                
                statusSelect.addEventListener('change', function() {
                    const newStatus = this.value;
                    this.className = `status-select ${getStatusClass(newStatus)}`;
                    employee.status = newStatus;
                    if (newStatus === 'å·²å®Œæˆ') {
                        const now = new Date();
                        employee.completedTime = formatDateForDisplay(now);
                    } else {
                        employee.completedTime = '--';
                    }
                    
                    const updatedData = {
                        employees: employeeData.employees
                    };
                    
                    fetch('http://localhost:8000/updateData', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(updatedData, null, 4)
                    }).then(response => {
                        if (!response.ok) {
                            throw new Error('ä¿å­˜å¤±è´¥');
                        }
                        alert('æ›´æ–°çŠ¶æ€æˆåŠŸï¼');
                        window.location.reload(); // å¼ºåˆ¶åˆ·æ–°æ•´ä¸ªé¡µé¢
                    }).catch(error => {
                        console.error('æ›´æ–°å¤±è´¥:', error);
                        alert('æ›´æ–°çŠ¶æ€å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                        this.value = employee.status;
                        this.className = `status-select ${getStatusClass(employee.status)}`;
                    });
                });

                statusCell.appendChild(statusSelect);
                
                const startTimeCell = document.createElement('td');
                startTimeCell.textContent = employee.startTime;
                
                const endTimeCell = document.createElement('td');
                endTimeCell.textContent = employee.endTime;
                
                const completedTimeCell = document.createElement('td');
                completedTimeCell.textContent = employee.completedTime || '--';
                
                const actionCell = document.createElement('td');
                const editButton = document.createElement('button');
                editButton.className = 'edit-button';
                editButton.textContent = 'ä¿®æ”¹';
                editButton.onclick = () => editTask(start + index);
                actionCell.appendChild(editButton);

                const deleteButton = document.createElement('button');
                deleteButton.className = 'edit-button';
                deleteButton.textContent = 'åˆ é™¤';
                deleteButton.onclick = () => deleteTask(start + index);
                actionCell.appendChild(deleteButton);

                row.appendChild(checkboxCell);
                row.appendChild(nameCell);
                row.appendChild(taskCell);
                row.appendChild(statusCell);
                row.appendChild(startTimeCell);
                row.appendChild(endTimeCell);
                row.appendChild(completedTimeCell);
                row.appendChild(actionCell);
                
                tableBody.appendChild(row);
            });
        }

        function getStatusClass(status) {
            switch(status) {
                case 'å¾…å¤„ç†': return 'status-pending';
                case 'å¤„ç†ä¸­': return 'status-processing';
                case 'å·²å®Œæˆ': return 'status-completed';
                default: return 'status-pending';
            }
        }

        function getAvatarColor(name) {
            const colors = ['blue', 'orange', 'pink'];
            const index = name.charCodeAt(0) % colors.length;
            return colors[index];
        }

        function deleteTask(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å—ï¼Ÿ')) {
                fetch('http://localhost:8000/deleteTask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ index: index }),
                }).then(response => {
                    if (!response.ok) {
                        throw new Error('åˆ é™¤å¤±è´¥');
                    }
                    alert('åˆ é™¤ä»»åŠ¡æˆåŠŸï¼');
                    window.location.reload(); // å¼ºåˆ¶åˆ·æ–°æ•´ä¸ªé¡µé¢
                }).catch(error => {
                    console.error('åˆ é™¤å¤±è´¥:', error);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                });
            }
        }
    </script>
</body>
</html>
